
#include "10kntc.h"

const signed char degC[] = {-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,
10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,
37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,
64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,
91,92,93,94,95,96,97,98,99,100,101};  

const unsigned int numbits[] = {3979,3921,3861,3801,3740,3679,3616,3553,3489,3424,
3359,3294,3229,3163,3097,3031,2965,2899,2833,2767,2702,2637,2573,2509,2446,2384,
2322,2261,2201,2141,2083,2025,1969,1914,1859,1806,1754,1702,1652,1603,1556,1509,
1464,1419,1376,1334,1293,1253,1214,1176,1139,1104,1069,1035,1003,971,940,911,882,
854,827,801,775,751,727,704,663,660,639,619,599,580,562,545,527,511,495,479,465,
450,436,423,410,397,385,373,362,351,340,330,320,310,301,292,283,275,267,259,252,
244,237,230,224,217,211,205,199,194,187,183,178,173,};
typedef const struct  {
    const signed char *degP;
    const unsigned int *numbits;
}  thermistorcurve_t;

static thermistorcurve_t tstat_data = {
    degC,
    numbits
};


/*********************************************************************
 * Function:        signed char ProcessRT(unsigned int numbits)
 *
 * PreCondition:    Adc & DMA init
 *
 * Input:           12 bit unsigned int from ADC buffer
 *
 * Output:          temperature in bits
 *
 * Side Effects:    None
 *
 * Overview:        Implements Thermistor plot 10K @ 25deg C
 *
 * Note:            See data sheet for USUG1000-103G R-T table
 *
 *  
Temp  Ohms    ADC Volts   Bits			
-10	55326	2.423808512	3979.126119
-9	52407	2.38848592	3921.137606
-8	49646	2.352350458	3861.81462
-7	47064	2.315865442	3801.917776
-6	44626	2.278739207	3740.968253
-5	42327	2.241068879	3679.125502
-4	40159	2.202907296	3616.476266
-3	38115	2.164320743	3553.129365
-2	36187	2.12535106	3489.153483
-1	34368	2.086050618	3424.634602
0	32650	2.046438746	3359.604451
1	31029	2.006617806	3294.231075
2	29498	1.966612792	3228.55551
3	28052	1.926487971	3162.683259
4	26685	1.88626968	3096.657558
5	25392	1.845999295	3030.546338
6	24170	1.805773149	2964.507743
7	23013	1.765580173	2898.523603
8	21917	1.725459837	2832.658715
9	20882	1.685597574	2767.217499
10	19901	1.645906118	2702.056697
11	18970	1.60638953	2637.182973
12	18090	1.567261748	2572.947544
13	17255	1.528425715	2509.191073
14	16462	1.48989633	2445.938024
15	15712	1.45188172	2383.530071
16	14999	1.414231835	2321.720881
17	14322	1.377035138	2260.655681
18	13681	1.340438229	2200.575145
19	13072	1.304354136	2141.33649
20	12492	1.268730764	2082.854193
21	11942	1.233754931	2025.434949
22	11419	1.19936026	1968.969789
23	10922	1.165597309	1913.541715
24	10450	1.132512315	1859.226631
25	10000	1.1	1805.851703
26	9572	1.068159069	1753.578977
27	9165	1.037013544	1702.447886
28	8777	1.00650172	1652.357133
29	8408	0.976710786	1603.449851
30	8057	0.947645864	1555.734452
31	7722	0.919219393	1509.067187
32	7403	0.89150458	1463.56824
33	7098	0.864395896	1419.064365
34	6808	0.838048344	1375.810026
35	6531	0.81234405	1333.611716
36	6267	0.787341531	1292.565496
37	6015	0.763002114	1252.60788
38	5775	0.739379243	1213.826606
39	5545	0.716324134	1175.977416
40	5326	0.693982469	1139.299476
41	5117	0.672297647	1103.699865
42	4917	0.651206004	1069.074065
43	4725	0.630637007	1035.306285
44	4543	0.610842195	1002.809472
45	4368	0.591529875	971.1047571
46	4201	0.572839965	940.4218428
47	4042	0.554804093	910.812651
48	3888	0.537106497	881.7588023
49	3742	0.52011625	853.8661959
50	3602	0.503626811	826.7957591
51	3468	0.487659792	800.5829692
52	3340	0.472236504	775.2628135
53	3217	0.457255459	750.668682
54	3099	0.442733452	726.8281435
55	2986	0.428687027	703.7683616
56	2788	0.40373881	662.8112887
57	2774	0.401958374	659.888376
58	2675	0.389305402	639.1162037
59	2579	0.376929891	618.7995318
60	2488	0.365101387	599.3808749
61	2400	0.353571429	580.4523332
62	2316	0.342480731	562.24492
63	2235	0.331706769	544.5574847
64	2157	0.32125739	527.4029143
65	2083	0.311275642	511.0160438
66	2011	0.30149925	494.9663044
67	1942	0.292070003	479.4864654
68	1876	0.282995063	464.5882879
69	1813	0.274281392	450.2831988
70	1752	0.265796249	436.3532803
71	1693	0.257543908	422.8055503
72	1637	0.249669548	409.8783434
73	1582	0.241896024	397.1166798
74	1530	0.234509986	384.9911435
75	1480	0.227374302	373.2766091
76	1432	0.220492721	361.9792328
77	1385	0.213724573	350.868077
78	1340	0.207216495	340.1838729
79	1297	0.200971968	329.9323369
80	1255	0.194848271	319.8791655
81	1215	0.188993637	310.2677096
82	1177	0.183411248	301.1031952
83	1140	0.177956481	292.1481942
84	1104	0.172630781	283.4050816
85	1070	0.167584243	275.1202643
86	1037	0.162670533	267.0535081
87	1005	0.157890978	259.2069929
88	973.8	0.153216871	251.5335879
89	944.1	0.148754542	244.2078571
90	915.5	0.144445507	237.1337861
91	887.8	0.140260822	230.2638587
92	861.1	0.13621669	223.6246749
93	835.4	0.132314234	217.2180778
94	810.6	0.128539302	211.0208342
95	786.6	0.124877565	205.0094219
96	763.5	0.121345149	199.2103126
97	741.2	0.117927603	193.5997844
98	716.6	0.11414904	187.3965801
99	698.7	0.111393952	182.8735986
100	678.6	0.108294565	177.7853867
101	659.1	0.105281934	172.8395997

 ********************************************************************/
signed char ProcessRT(unsigned int adcbits) {
    unsigned char i=0;
    unsigned char retval=0;
    unsigned int tablebits=65535;
    
    while(adcbits < tablebits && i!=255)
    {
        tablebits = tstat_data.numbits[i];
        if(i<255){
            i++;
        }
    }

    if(i==255){
        retval =255;//error throw OT
    }
    else{
       retval = tstat_data.degP[i];
    }
    return retval;
}



